# Practical Malware Analysis

> [Practical Malware Analysis](https://nostarch.com/malware) - The Hands-On Guide to Dissecting Malicious Software by Michael Sikorski and Andrew Honig

## Chapter 1 - Basic Static Techniques

- **File signature:** Identifiable pieces of known suspicious code.
- **Heuristics:** Behavioral and pattern-matching analysis.
- **Hashing:** Cryptographic fingerprint.
- **Strings:** Always end with a NULL byte.
    - ASCII (1 byte per character).
    - Unicode (2 bytes per character), always ends with a NULL byte.
- **Packed programs:**
    - Compressed/obfuscated programs.
    - Contains a wrapper/stub to unpack and run itself.
- **Linked libraries:**
    - Static linking: Libraries are inside the executable.
    - Runtime linking: Import libraries at execution (i.e. LoadLibrary, GetProcAddress...).
    - Dynamic linking: The OS searches for the necessary libraries.
- **Function naming conventions:**
    - `Ex` suffix: Means a new version of the function (i.e. CreateFile & CreateFileEx).
    - `A` (ASCII) or `W` (Wide) suffixes (i.e. FindFirstFileA & FindFirstFileW).
- **Imported/Exported functions:** List of imported and exported function by an executable or a library.
- **PE file and sections:**
    - .text: Code instructions.
    - .rdata: Import & export information, also read-only data used by the program.
    - .data: Program's global data accessible from anywhere.
    - .rsrc: Resources (icons, images, menus, strings...)
- **Virtual & Raw Size:** Virtual means in-memory and raw means on disk. If a section has no size on disk but a virtual size, this often means that it will be filled at runtime.

## Chapter 2 - Malware Analysis in Virutal Machines

*skipped...*

## Chapter 3 - Basic Dynamic Analysis

- **Use a sandbox:** Quick and dirty approach.
- **Running a malware:** `rundll32.exe name.dll,#1` (or function name)
- **Monitoring:**
    - Process Monitor (ProcMon): You can filter on PID or Process name.
    - Process Explorer Display: Process tree view (some processes could have been replaced by another, you need to compare memory).
    - Regshot: Snapshot and comparaison of two registry.
- **Network:**
    - ApateDNS or flare-fakenet-ng: Custom DNS to redirect and see network traffic.
    - Wireshark: Open source sniffer.
    - INetSim: Simulates commin Internet services.

## Tools

- [Detect It Easy](https://github.com/horsicq/Detect-It-Easy): Detect file and packed types.
- [Dependencies](https://github.com/lucasg/Dependencies): An open-source modern Dependency Walker.
- [FakeNet-NG](https://github.com/mandiant/flare-fakenet-ng): Dynamic network analysis tool. 
- [INetSim](https://www.inetsim.org/): Simulates common internet services.

